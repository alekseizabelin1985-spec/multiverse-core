# SemanticMemory Agent Guide

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

SemanticMemory ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ —Å –¥–≤–æ–π–Ω—ã–º –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ RAG –≤ –∏–≥—Ä–æ–≤–æ–π –≤—Å–µ–ª–µ–Ω–Ω–æ–π.

## üîå API Endpoints

### POST /v1/context/structured ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å ID (RECOMMENDED)

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "entity_ids": ["player_123", "npc_elder123"],
  "world_id": "world_alpha",
  "time_range": "last_2h",
  "max_events": 50,
  "event_types": ["entity.moved", "item.found", "npc.met"]
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `entity_ids` | `[]string` | ‚úÖ | IDs —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| `world_id` | `string` | ‚ùå | –§–∏–ª—å—Ç—Ä –ø–æ –º–∏—Ä—É |
| `time_range` | `string` | ‚ùå | `"last_1h"`, `"last_2h"`, `"last_24h"`, `"last_7d"` (default: `"last_2h"`) |
| `max_events` | `int` | ‚ùå | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π (default: all) |
| `event_types` | `[]string` | ‚ùå | –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π |

**–û—Ç–≤–µ—Ç:**
```json
{
  "context": "{event_456:10:00} {player_123:–í–∞—Å—è} {event_456:entered} {region_forest123:–¢–µ–º–Ω—ã–π –ª–µ—Å}. {event_789:10:15} {player_123:–í–∞—Å—è} {event_789:found} {items_bottle_life:–ë—É—Ç—ã–ª—å –∂–∏–∑–Ω–∏}. {event_123:10:30} {player_123:–í–∞—Å—è} {event_123:met} {npc_elder123:–õ–µ—Å–Ω–∏–∫}.",
  "entities": {
    "player_123": {
      "id": "player_123",
      "name": "–í–∞—Å—è",
      "type": "player",
      "world_id": "world_alpha",
      "description": "–û—Ç–≤–∞–∂–Ω—ã–π –≤–æ–∏–Ω 3 —É—Ä–æ–≤–Ω—è"
    },
    "region_forest123": {
      "id": "region_forest123",
      "name": "–¢–µ–º–Ω—ã–π –ª–µ—Å",
      "type": "region",
      "description": "–ì—É—Å—Ç–æ–π, —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–µ—Å —Å –¥—Ä–µ–≤–Ω–∏–º–∏ –¥–µ—Ä–µ–≤—å—è–º–∏"
    }
  },
  "timeline": [
    {
      "timestamp": "2024-01-15T10:00:00Z",
      "event_id": "event_456",
      "type": "entity.moved",
      "format": "{event_456:10:00} {player_123:–í–∞—Å—è} {event_456:entered} {region_forest123:–¢–µ–º–Ω—ã–π –ª–µ—Å}",
      "entities": ["player_123", "region_forest123"]
    }
  ],
  "metadata": {
    "request_time": "2024-01-15T14:30:00Z",
    "entity_count": 4,
    "event_count": 3,
    "time_range": "last_2h",
    "processing_ms": 45,
    "source_indexes": ["chroma:world_memory", "neo4j:entity_graph"]
  }
}
```

### –§–æ—Ä–º–∞—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `{event_id:time} {entity_id:name} {event_id:action} {target_id:name}`

**–ü—Ä–∏–º–µ—Ä—ã:**
```
{event_456:10:00} {player_123:–í–∞—Å—è} {event_456:entered} {region_forest123:–¢–µ–º–Ω—ã–π –ª–µ—Å}
{event_789:10:15} {player_123:–í–∞—Å—è} {event_789:found} {items_bottle_life:–ë—É—Ç—ã–ª—å –∂–∏–∑–Ω–∏}
{event_123:10:30} {player_123:–í–∞—Å—è} {event_123:met} {npc_elder123:–õ–µ—Å–Ω–∏–∫}
{event_122313:10:35} {npc_elder123:–õ–µ—Å–Ω–∏–∫} {event_122313:offered} {quest_secret_path:–∫–≤–µ—Å—Ç}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞:**
- ‚úÖ **–ú–∞—à–∏–Ω–Ω–æ-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã–π**: AI –ª–µ–≥–∫–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç ID –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ **–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏-—á–∏—Ç–∞–µ–º—ã–π**: –¢–µ–∫—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º
- ‚úÖ **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π**: –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ ID
- ‚úÖ **–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π**: –°–æ–±—ã—Ç–∏—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏

## ü§ñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ AscensionOracle –ø—Ä–æ–º–ø—Ç–∞—Ö

```text
–¢—ã - Game Master –¥–ª—è RPG –∏–≥—Ä—ã. –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞:

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
{event_456:10:00} {player_123:–í–∞—Å—è} {event_456:entered} {region_forest123:–¢–µ–º–Ω—ã–π –ª–µ—Å}. 
{event_789:10:15} {player_123:–í–∞—Å—è} {event_789:found} {items_bottle_life:–ë—É—Ç—ã–ª—å –∂–∏–∑–Ω–∏}. 
{event_123:10:30} {player_123:–í–∞—Å—è} {event_123:met} {npc_elder123:–õ–µ—Å–Ω–∏–∫}.

–î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞:
"–Ø —Ö–æ—á—É –ø—Ä–∏–Ω—è—Ç—å –∫–≤–µ—Å—Ç"

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç –æ—Ç –ª–∏—Ü–∞ –õ–µ—Å–Ω–∏–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π ID —Å—É—â–Ω–æ—Å—Ç–µ–π –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å—Å—ã–ª–æ–∫:
- {npc_elder123:–õ–µ—Å–Ω–∏–∫} –¥–ª—è —Å–µ–±—è
- {player_123:–í–∞—Å—è} –¥–ª—è –∏–≥—Ä–æ–∫–∞  
- {quest_secret_path:–∫–≤–µ—Å—Ç} –¥–ª—è –∫–≤–µ—Å—Ç–∞

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ JSON:
{
  "narrative": "–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞...",
  "actions": [
    {"id": "accept", "target": "quest_secret_path", "desc": "–ü—Ä–∏–Ω—è—Ç—å –∫–≤–µ—Å—Ç"},
    {"id": "ask", "target": "npc_elder123", "desc": "–†–∞—Å—Å–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ"}
  ]
}
```

## üîÑ Legacy Endpoints (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

### POST /v1/context
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `map[string]string` —Å plain text –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

### POST /v1/events
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø—É.

### POST /v1/context-with-events
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—É—â–Ω–æ—Å—Ç–µ–π —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–±—ã—Ç–∏–π.

> ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/v1/context/structured` –¥–ª—è –Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```env
# ChromaDB (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç v2)
CHROMA_URL=http://chromadb:8000
CHROMA_COLLECTION_NAME=world_memory
CHROMA_USE_V2=true

# Embedding –º–æ–¥–µ–ª—å
EMBEDING_URL=http://qwen3-service:11434
EMBEDING_MODEL=nomic-embed-text:latest

# Neo4j
NEO4J_URI=bolt://neo4j:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=***

# Kafka
KAFKA_BROKERS=kafka:9092

# –°–µ—Ä–≤–∏—Å
SEMANTIC_PORT=8080
```

## üì° –ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ Kafka —Ç–æ–ø–∏–∫–∏

- `player_events` ‚Äî —Å–æ–±—ã—Ç–∏—è –∏–≥—Ä–æ–∫–æ–≤
- `world_events` ‚Äî —Å–æ–±—ã—Ç–∏—è –º–∏—Ä–∞
- `game_events` ‚Äî –∏–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- `system_events` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `scope_management` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ scope
- `narrative_output` ‚Äî –≤—ã–≤–æ–¥ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ endpoint
curl -X POST http://localhost:8080/v1/context/structured \
  -H "Content-Type: application/json" \
  -d '{
    "entity_ids": ["player_123"],
    "time_range": "last_1h"
  }'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health
curl http://localhost:8080/health
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –°–æ–æ–±—â–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|-----|-----------|---------|
| 400 | `invalid_json` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON –≤ –∑–∞–ø—Ä–æ—Å–µ |
| 400 | `entity_ids_required` | –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `entity_ids` |
| 500 | `failed_to_load_events` | –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π |
| 500 | `internal_error` | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

---

**–í–µ—Ä—Å–∏—è:** 2.0  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2026-02-16  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production-ready —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π structured context
